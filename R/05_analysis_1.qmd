---
format:
  revealjs:
    embed-resources: true
---
# Analysis of data

```{r}
library(ggplot2)
library(tidyverse)
library(patchwork)
```

```{r}
#| message: false
data <- read_tsv("../data/03_dat_aug.tsv")
```

## Getting an overview of the sample

```{r}
#Violin plot
ggplot(data = data,
                      aes(x = age,
                          y = diagnose,
                          color = diagnose,
                          fill = diagnose)) +
  geom_violin(alpha = 0.4) +
  scale_fill_manual(values = c("darkgreen", "red")) +
  scale_color_manual(values = c("darkgreen", "red")) +
  theme_minimal()

```

The plot shows us there is an uneven distribution between the observations which are diagnose and not diagnose. The distribution of non-diagnose patients is relatively even, while the distribution of diagnose patients is larger around the age-group 55-60 years.

### Distribution between continuous variables

```{r}
#Plotting the distribution of numerical variables, divided by diagnosis
library(ggpubr)

# Density-plot of age attribute
density_p1 <- ggplot(data = data,
       aes(x = age,
           color = diagnose,
           fill = diagnose)) +
  geom_density(alpha = 0.4) +
  scale_fill_manual(values = c("darkgreen", "red")) +
  scale_color_manual(values = c("darkgreen", "red")) +
  theme_minimal()

# Density-plot of trestbps attribute
density_p2 <- ggplot(data = data,
       aes(x = trestbps,
           color = diagnose,
           fill = diagnose)) +
  geom_density(alpha = 0.4) +
  scale_fill_manual(values = c("darkgreen", "red")) +
  scale_color_manual(values = c("darkgreen", "red")) +
  theme_minimal()

# Density-plot of chol attribute
density_p3 <- ggplot(data = data,
       aes(x = chol,
           color = diagnose,
           fill = diagnose)) +
  geom_density(alpha = 0.4) +
  scale_fill_manual(values = c("darkgreen", "red")) +
  scale_color_manual(values = c("darkgreen", "red")) +
  theme_minimal()

# Density-plot of thalach attribute
density_p4 <- ggplot(data = data,
       aes(x = thalach,
           color = diagnose,
           fill = diagnose)) +
  geom_density(alpha = 0.4) +
  scale_fill_manual(values = c("darkgreen", "red")) +
  scale_color_manual(values = c("darkgreen", "red")) +
  theme_minimal()

# All density plots
ggarrange(density_p1, density_p2, density_p3, density_p4, ncol=2, nrow=2, common.legend = TRUE, legend = "bottom")
```

The plots show that, out of the four variables included in the analysis, that 'age' and 'thalach' seem to be the best at separating diagnose from non-diagnose, as their peaks are in relatively different positions.

### Distribution of categorical variables

```{r}
# Plotting the disctribution of categorical variables, divided by diagnosis

# Bar-plot of cp attribute
bar_p1 <- ggplot(data = data,
       aes(y = cp,
           color = diagnose,
           fill = diagnose)) +
  geom_bar(alpha = 0.4,
           position = "fill") +
  scale_fill_manual(values = c("darkgreen", "red")) +
  scale_color_manual(values = c("darkgreen", "red")) +
  theme(axis.title.x = element_blank(),
        axis.text.y = element_text(angle = 20, hjust = 1)) +
  theme_minimal()

# Bar-plot of thal attribute
bar_p2 <- ggplot(data = data,
       aes(y = thal,
           color = diagnose,
           fill = diagnose)) +
  geom_bar(alpha = 0.4,
           position = "fill") +
  scale_fill_manual(values = c("darkgreen", "red")) +
  scale_color_manual(values = c("darkgreen", "red")) +
  theme(axis.title.x = element_blank(),
        axis.text.y = element_text(angle = 20, hjust = 1)) +
  theme_minimal()

# Bar-plot of fbs attribute
bar_p3 <- ggplot(data = data,
       aes(y = fbs,
           color = diagnose,
           fill = diagnose)) +
  geom_bar(alpha = 0.4,
           position = "fill") +
  scale_fill_manual(values = c("darkgreen", "red")) +
  scale_color_manual(values = c("darkgreen", "red")) +
  theme(axis.title.x = element_blank(),
        axis.text.y = element_text(angle = 20, hjust = 1)) +
  theme_minimal()

# Bar-plot of exang attribute
bar_p4 <- ggplot(data = data,
       aes(y = exang,
           color = diagnose,
           fill = diagnose)) +
  geom_bar(alpha = 0.4,
           position = "fill") +
  scale_fill_manual(values = c("darkgreen", "red")) +
  scale_color_manual(values = c("darkgreen", "red")) +
  theme(axis.title.x = element_blank(),
        axis.text.y = element_text(angle = 20, hjust = 1)) +
  theme_minimal()

# Bar-plot of restecg attribute
bar_p5 <- ggplot(data = data,
       aes(y = restecg,
           color = diagnose,
           fill = diagnose)) +
  geom_bar(alpha = 0.4,
           position = "fill") +
  scale_fill_manual(values = c("darkgreen", "red")) +
  scale_color_manual(values = c("darkgreen", "red")) +
  theme(axis.title.x = element_blank(),
        axis.text.y = element_text(angle = 20, hjust = 1)) +
  theme_minimal()

# Bar-plot of ca attribute
bar_p6 <- ggplot(data = data |> 
                   filter(ca !='?'),
       aes(y = ca,
           color = diagnose,
           fill = diagnose)) +
  geom_bar(alpha = 0.4,
           position = "fill") +
  scale_fill_manual(values = c("darkgreen", "red")) +
  scale_color_manual(values = c("darkgreen", "red")) +
  theme(axis.title.x = element_blank(),
        axis.text.y= element_text(angle = 20, hjust = 1)) +
  theme_minimal()

# All bar plots
ggarrange(bar_p1, bar_p2, bar_p3, bar_p4, bar_p5, bar_p6, ncol = 2, nrow = 3, common.legend = TRUE, legend = "bottom")


```

The plots show us that the variables fbs and restecg are not the best at separating diagnose from non-diagnose patients, while cp, exang, thal, and ca do show separation between the two.

### Slope and oldpeak

```{r}
ggplot(data, 
       aes(x = slope,
           fill = diagnose,
           color = diagnose)) + 
  geom_bar(alpha = 0.4,
           position = "fill") +
  scale_fill_manual(values = c("darkgreen", "red")) +
  scale_color_manual(values = c("darkgreen", "red")) + 
  labs(title = "Boxplot of Slope by Diagnosis",
       x = "Slope") +
  theme_minimal() +
  theme(legend.position = "bottom",  
        plot.title = element_text(hjust = 0.5),  
        axis.title.x = element_text(face = "bold"), 
        axis.title.y = element_text(face = "bold")) 
```

The plot shows us that downward and flat slopes could be good indicators of heart disease.

```{r}
ggplot(data, 
       aes(x = diagnose, 
           y = oldpeak, 
           color = diagnose,
           fill = diagnose)) + 
  geom_boxplot(alpha = 0.4) +
  scale_fill_manual(values = c("darkgreen", "red")) + 
  scale_color_manual(values = c("darkgreen", "red")) + 
  labs(title = "Boxplot of Oldpeak by Diagnosis",
       x = "diagnose",
       y = "Oldpeak Value") +
  theme_minimal() +  
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5), 
        axis.title.x = element_text(face = "bold"), 
        axis.title.y = element_text(face = "bold")) 
```

These two plots show that the patients are more likely to be diagnose with heart diseases with higher oldpeak and abnormal slope such as flat and downsloping ST segment.

### Results

From the visualization, we have formed a general overview and understanding of our data. Out of five numerical variables
