---
format:
  revealjs:
    embed-resources: true
---

# Analysis of data

Since our interested variables consist of both numerical and categorical types, we introduced a logistic regression model to fit our data for further analysis.

```{r}
#| message: false
data <- read_tsv("../data/03_dat_aug.tsv")
```

## Data visualization

```{r}
p1 <- ggplot(data |> filter (cp=="asymptomatic"), 
             aes(x = oldpeak, 
                 y = thalach, 
                 color = diagnose)) +
  geom_point() +
  geom_smooth(data = filter(data,
                            cp == "asymptomatic"), 
              method = "lm", 
              formula = y ~ x, 
              se = FALSE, 
              color = "black") +
  scale_color_manual(values = c("darkgreen", 
                                "red"))+
  facet_wrap(~sex) +
  labs(title = "Relationship between Max heart rate and ST depression",
       subtitle = "Focused on asymptomatic chest pain and stratified by sex",
       x = "ST depression",
       y = "Max heart rate",
       color = "Angiographic disease status") +
  theme_minimal() +
  theme(legend.position = "right",  
        plot.title = element_text(hjust = 0.5),  
        axis.title.x = element_text(face = "bold"), 
        axis.title.y = element_text(face = "bold")
        )
p1
```

From the horizontal bar charts in 05_analysis_1, we see that asymptomatic chest pain is highly linked to an individual being sick. To understand some of the underlying reasons for this, we decided to plot the ST depression against the max heart rate for patients experiencing the asymptomatic chest pain. As ST depression is usually linked to blood supply to the heart, a higher value combined with a lower than average max heart rate could imply that a patient is sick, which is exactly what we see in the plot above. In conclusion, for the people experiencing asymptomatic chest pain, we see an inverse correlation between maximum heart rate and their level of ST depression leading to the idea that these could be influential in predicting a patient to be sick.

## Logistic regression

```{r}
data_log <- data
# Convert categorical variables to factors
data_log$exang <- as.factor(data$exang)
data_log$slope <- as.factor(data$slope)
data_log$diagnose <- as.factor(data$diagnose)
data_log$cp <- as.factor(data$cp)
data_log$thal <- as.factor(data$thal)
data_log$ca <- as.factor(data$ca)
# Fit the logistic regression model
model <- glm(diagnose ~ age + thalach + thal + exang + ca + slope + oldpeak + cp, 
             data = data_log, family = binomial())

# Summary of the model to view the coefficients
summary(model)

# To get the odds ratios
exp(coef(model))
```

In summary, the model suggests that the type of chest pain (cp) greatly influences the likelihood of a heart disease diagnosis. The presence of a higher number of detectable vessels (thal) and higher ST depression (oldpeak) values are also associated with an increased likelihood of being diagnosed as sick.

# Conclusion
